{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}

<h1>Titanic Survival Prediction</h1>
<br>
<br>
<p class="lead">Upload a csv file to predict if passengers would have survived the Titanic disaster. </p>
<br>
<div class="custom-file mb-3">
    <input class="form-control-file" id="files" name="filename" type="file">
</div>

<br>
<br>

<p class="lead">The expected column headings are <br><br>
    <i>'PassengerId', 'Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp',
        'Parch', 'Ticket', 'Fare', 'Cabin', 'Embarked'</i> </p>

<script type="text/javascript">
  document.getElementById('files').addEventListener('change', function() {
    let file = this.files[0];
    let xhr = new XMLHttpRequest();

    xhr.open('post', '/api/predict', true);
    xhr.send(file);

     xhr.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
            let blob = new Blob([this.response], {type: 'text/csv'})
            let a = document.createElement("a")
            a.style = "display: none";
            document.body.appendChild(a)
            let url = window.URL.createObjectURL(blob)
            a.href = url
            a.download = 'Predictions.csv'
            a.click()
            window.URL.revokeObjectURL(url)
        } };
  }
  )

</script>
{% endblock %}




